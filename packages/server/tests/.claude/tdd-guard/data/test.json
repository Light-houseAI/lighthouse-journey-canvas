{
  "testModules": [
    {
      "moduleId": "/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/quality-improvements.test.ts",
      "tests": [
        {
          "name": "should have increased answer summary limit to 1500 characters",
          "fullName": "Quality Improvements Validation > Context Truncation Removal > should have increased answer summary limit to 1500 characters",
          "state": "passed"
        },
        {
          "name": "should pass full context without truncation",
          "fullName": "Quality Improvements Validation > Context Truncation Removal > should pass full context without truncation",
          "state": "passed"
        },
        {
          "name": "should include screenshotDescriptions field in SessionInfo type",
          "fullName": "Quality Improvements Validation > Screenshot Descriptions in SessionInfo > should include screenshotDescriptions field in SessionInfo type",
          "state": "passed"
        },
        {
          "name": "should provide richer context for insight generation",
          "fullName": "Quality Improvements Validation > Screenshot Descriptions in SessionInfo > should provide richer context for insight generation",
          "state": "passed"
        },
        {
          "name": "should have comprehensive agent prompts defined",
          "fullName": "Quality Improvements Validation > Rich System Prompts > should have comprehensive agent prompts defined",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'length')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'length')\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/quality-improvements.test.ts:156:37\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            },
            {
              "message": "Cannot read properties of undefined (reading 'length')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'length')\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/quality-improvements.test.ts:156:37\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            }
          ]
        },
        {
          "name": "should use gemini-3-flash-preview for high quality analysis",
          "fullName": "Quality Improvements Validation > Gemini Model Configuration > should use gemini-3-flash-preview for high quality analysis",
          "state": "passed"
        }
      ]
    },
    {
      "moduleId": "/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts",
      "tests": [
        {
          "name": "should create a compiled graph",
          "fullName": "A1 Retrieval Agent Graph > createRetrievalGraph > should create a compiled graph",
          "state": "passed"
        },
        {
          "name": "should log graph creation",
          "fullName": "A1 Retrieval Agent Graph > createRetrievalGraph > should log graph creation",
          "state": "passed"
        },
        {
          "name": "should retrieve user evidence via NLQ service",
          "fullName": "A1 Retrieval Agent Graph > User Evidence Retrieval > should retrieve user evidence via NLQ service",
          "state": "passed"
        },
        {
          "name": "should transform NLQ result to EvidenceBundle format",
          "fullName": "A1 Retrieval Agent Graph > User Evidence Retrieval > should transform NLQ result to EvidenceBundle format",
          "state": "passed"
        },
        {
          "name": "should log user evidence retrieval output",
          "fullName": "A1 Retrieval Agent Graph > User Evidence Retrieval > should log user evidence retrieval output",
          "state": "failed",
          "errors": [
            {
              "message": "expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 1,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  38th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  39th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  40th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  41st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  42nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  43rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  44th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  45th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  46th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  47th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  48th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  49th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  50th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  51st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  52nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  53rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  54th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  55th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m55\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 1,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  38th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  39th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  40th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  41st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  42nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  43rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  44th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  45th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  46th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  47th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  48th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  49th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  50th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  51st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  52nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  53rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  54th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  55th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m55\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:198:31\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            },
            {
              "message": "expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  38th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  39th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  40th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  41st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  42nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  43rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  44th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  45th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  46th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  47th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  48th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  49th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  50th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  51st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  52nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  53rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  54th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  55th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m55\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  38th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  39th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  40th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Fetched chapter data for sessions\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"sessionsWithChapters\": 0,\u001b[90m\n\u001b[31m+     \"totalSessions\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  41st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  42nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 1,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 2,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": true,\u001b[90m\n\u001b[31m+         \"stepCount\": 1,\u001b[90m\n\u001b[31m+         \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-1\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+       {\u001b[90m\n\u001b[31m+         \"hasStepDescriptions\": false,\u001b[90m\n\u001b[31m+         \"stepCount\": 0,\u001b[90m\n\u001b[31m+         \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+         \"workflowId\": \"wf-session-2\",\u001b[90m\n\u001b[31m+       },\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  43rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 2,\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"workflowCount\": 2,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  44th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  45th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"React Research\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  46th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Session [session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"appsUsed\": [],\u001b[90m\n\u001b[31m+     \"durationSeconds\": 0,\u001b[90m\n\u001b[31m+     \"endActivity\": \"Work session completed\",\u001b[90m\n\u001b[31m+     \"hasScreenshotDescriptions\": false,\u001b[90m\n\u001b[31m+     \"highLevelSummary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"screenshotDescriptionCount\": 0,\u001b[90m\n\u001b[31m+     \"startActivity\": \"Feature Implementation\",\u001b[90m\n\u001b[31m+     \"workflowCount\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  47th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  48th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"Browser-based workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Browser\",\u001b[90m\n\u001b[31m+     \"stepCount\": 1,\u001b[90m\n\u001b[31m+     \"summary\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"title\": \"Research session about React patterns\",\u001b[90m\n\u001b[31m+     \"tools\": [\u001b[90m\n\u001b[31m+       \"Browser\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 30,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  49th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"  Step [step-source-1]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"agenticPattern\": \"(none)\",\u001b[90m\n\u001b[31m+     \"app\": \"Browser\",\u001b[90m\n\u001b[31m+     \"description\": \"User using Chrome for search\",\u001b[90m\n\u001b[31m+     \"durationSeconds\": 30,\u001b[90m\n\u001b[31m+     \"rawActionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepSummary\": \"(none)\",\u001b[90m\n\u001b[31m+     \"toolCategory\": \"browser\",\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  50th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"Workflow [wf-session-2]\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"approach\": \"General workflow\",\u001b[90m\n\u001b[31m+     \"intent\": \"Extracted from session\",\u001b[90m\n\u001b[31m+     \"primaryApp\": \"Unknown\",\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"summary\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"title\": \"Coding session implementing feature\",\u001b[90m\n\u001b[31m+     \"tools\": [],\u001b[90m\n\u001b[31m+     \"totalDurationSeconds\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  51st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  52nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  53rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  54th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  55th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (User Evidence) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 1,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m55\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:198:31\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            }
          ]
        },
        {
          "name": "should retrieve peer evidence when includePeerComparison is true",
          "fullName": "A1 Retrieval Agent Graph > Peer Evidence Retrieval > should retrieve peer evidence when includePeerComparison is true",
          "state": "failed",
          "errors": [
            {
              "message": "expected \"spy\" to be called with arguments: [ 'How can I improve my workflow?' ]\u001b[90m\n\nNumber of calls: \u001b[1m0\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ 'How can I improve my workflow?' ]\u001b[90m\n\nNumber of calls: \u001b[1m0\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:256:54\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            },
            {
              "message": "expected \"spy\" to be called with arguments: [ 'How can I improve my workflow?' ]\u001b[90m\n\nNumber of calls: \u001b[1m0\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ 'How can I improve my workflow?' ]\u001b[90m\n\nNumber of calls: \u001b[1m0\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:256:54\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            }
          ]
        },
        {
          "name": "should skip peer evidence when includePeerComparison is false",
          "fullName": "A1 Retrieval Agent Graph > Peer Evidence Retrieval > should skip peer evidence when includePeerComparison is false",
          "state": "failed",
          "errors": [
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:270:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            },
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:270:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            }
          ]
        },
        {
          "name": "should return null peerEvidence when no patterns found",
          "fullName": "A1 Retrieval Agent Graph > Peer Evidence Retrieval > should return null peerEvidence when no patterns found",
          "state": "failed",
          "errors": [
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:281:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            },
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:281:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            }
          ]
        },
        {
          "name": "should fail critique when insufficient user evidence",
          "fullName": "A1 Retrieval Agent Graph > Critique Loop > should fail critique when insufficient user evidence",
          "state": "passed"
        },
        {
          "name": "should pass critique with sufficient evidence",
          "fullName": "A1 Retrieval Agent Graph > Critique Loop > should pass critique with sufficient evidence",
          "state": "passed"
        },
        {
          "name": "should log critique output",
          "fullName": "A1 Retrieval Agent Graph > Critique Loop > should log critique output",
          "state": "failed",
          "errors": [
            {
              "message": "expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m37\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m37\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:337:31\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            },
            {
              "message": "expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 1ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 1,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m37\u001b[22m\n\u001b[39m",
              "stack": "AssertionError: expected \"spy\" to be called with arguments: [ Array(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Creating A1 Retrieval Graph\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  2nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  3rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 1ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  4th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  5th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  6th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 1,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  7th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  8th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  9th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  10th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  11th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  12th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  13th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  14th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  15th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  16th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  17th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  18th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  19th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  20th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  21st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  22nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  23rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  24th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  25th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": true,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  26th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Retrieving user evidence via NLQ\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"filterNoise\": true,\u001b[90m\n\u001b[31m+     \"nodeId\": null,\u001b[90m\n\u001b[31m+     \"query\": \"How can I improve my workflow?\",\u001b[90m\n\u001b[31m+     \"queryClassification\": {\u001b[90m\n\u001b[31m+       \"filters\": {},\u001b[90m\n\u001b[31m+       \"intent\": \"OPTIMIZATION\",\u001b[90m\n\u001b[31m+       \"maxResults\": 500,\u001b[90m\n\u001b[31m+       \"scope\": \"HOLISTIC\",\u001b[90m\n\u001b[31m+       \"specificity\": \"BROAD\",\u001b[90m\n\u001b[31m+       \"useSemanticSearch\": true,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"userId\": 1,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  27th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: NLQ query took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  28th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1 PROFILING: Session chapters fetch took 0ms\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  29th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"Transformed NLQ to evidence\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"entityCount\": 0,\u001b[90m\n\u001b[31m+     \"knowledgeBaseEntries\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"totalStepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowSamples\": [],\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  30th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: User evidence retrieved\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"elapsedMs\": 0,\u001b[90m\n\u001b[31m+     \"sessionCount\": 0,\u001b[90m\n\u001b[31m+     \"stepCount\": 0,\u001b[90m\n\u001b[31m+     \"workflowCount\": 0,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  31st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Sessions ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  32nd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== A1 DOWNSTREAM DATA: Workflows & Steps (VLM Descriptions) ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  33rd spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"=== END A1 DOWNSTREAM DATA ===\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  34th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed repetitive patterns from stitched_context\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  35th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Loading pre-computed stitched context from DB\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  36th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Running critique loop\",\u001b[90m\n\u001b[2m  ]\u001b[22m\n\n\u001b[1m  37th spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"=== A1 RETRIEVAL AGENT OUTPUT (Critique) ===\",\u001b[90m\n\u001b[31m+   \"A1: Critique complete\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"canRetry\": false,\u001b[90m\n\u001b[31m+     \"issueCount\": 2,\u001b[90m\n\u001b[31m+     \"passed\": false,\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m37\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1355:10)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:337:31\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"
            }
          ]
        },
        {
          "name": "should handle NLQ service errors gracefully",
          "fullName": "A1 Retrieval Agent Graph > Error Handling > should handle NLQ service errors gracefully",
          "state": "passed"
        },
        {
          "name": "should handle embedding service errors gracefully",
          "fullName": "A1 Retrieval Agent Graph > Error Handling > should handle embedding service errors gracefully",
          "state": "failed",
          "errors": [
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:378:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            },
            {
              "message": "expected undefined to be null",
              "stack": "AssertionError: expected undefined to be null\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/retrieval-graph.test.ts:378:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20",
              "expected": "null",
              "actual": "undefined"
            }
          ]
        },
        {
          "name": "should include screenshotDescriptions in session data",
          "fullName": "A1 Retrieval Agent Graph > Screenshot Descriptions Integration > should include screenshotDescriptions in session data",
          "state": "passed"
        },
        {
          "name": "should include screenshot description content",
          "fullName": "A1 Retrieval Agent Graph > Screenshot Descriptions Integration > should include screenshot description content",
          "state": "passed"
        }
      ]
    },
    {
      "moduleId": "/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts",
      "tests": [
        {
          "name": "should classify workflow analysis queries as relevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify workflow analysis queries as relevant",
          "state": "passed"
        },
        {
          "name": "should classify efficiency queries as relevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify efficiency queries as relevant",
          "state": "passed"
        },
        {
          "name": "should classify tool usage queries as relevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify tool usage queries as relevant",
          "state": "passed"
        },
        {
          "name": "should classify peer comparison queries as relevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify peer comparison queries as relevant",
          "state": "passed"
        },
        {
          "name": "should classify best practices queries as relevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify best practices queries as relevant",
          "state": "passed"
        },
        {
          "name": "should classify conversational queries correctly",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify conversational queries correctly",
          "state": "passed"
        },
        {
          "name": "should classify irrelevant queries as irrelevant",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify irrelevant queries as irrelevant",
          "state": "passed"
        },
        {
          "name": "should classify prompt injection attempts as unsafe",
          "fullName": "Guardrail Classification > Pattern-based classification > should classify prompt injection attempts as unsafe",
          "state": "passed"
        },
        {
          "name": "should create registry with all 7 skills",
          "fullName": "Skill Registry > should create registry with all 7 skills",
          "state": "failed",
          "errors": [
            {
              "message": "expected 4 to be 7 // Object.is equality",
              "stack": "AssertionError: expected 4 to be 7 // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:192:27\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "7",
              "actual": "4"
            },
            {
              "message": "expected 4 to be 7 // Object.is equality",
              "stack": "AssertionError: expected 4 to be 7 // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:192:27\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "7",
              "actual": "4"
            }
          ]
        },
        {
          "name": "should format skills for LLM prompt",
          "fullName": "Skill Registry > should format skills for LLM prompt",
          "state": "failed",
          "errors": [
            {
              "message": "expected '\\n### Retrieve User Workflows (`retri' to contain 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected '\\n### Retrieve User Workflows (`retri' to contain 'analyze_workflow_efficiency'\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:207:23\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "analyze_workflow_efficiency",
              "actual": "\n### Retrieve User Workflows (`retrieve_user_workflows`)\n\n**Description:** This skill retrieves the user's captured workflow data from their recorded work sessions. It uses a hybrid RAG (Retrieval-Augmented Generation) approach combining semantic vector search with graph-based retrieval from ArangoDB.\n\nThe skill searches across all user sessions using natural language, extracts workflows, steps, tools used, and duration metrics. It also identifies entities (technologies, tools, people) mentioned in the workflows and can retrieve anonymized peer patterns for comparison.\n\nThis is typically the FIRST skill to invoke when you need to understand what the user has been working on before performing any analysis or providing recommendations.\n\n**When to Use:**\n- User asks about their past work (e.g., \"What did I work on yesterday?\")\n- Need to understand user workflow patterns before analysis\n- Looking for specific sessions or activities\n- User references a task, project, or timeframe\n- Starting any analysis that requires user context\n- User asks about their tools, apps, or technologies used\n- Need to gather evidence for efficiency analysis\n\n**Capabilities:**\n- Searches across all user sessions using natural language queries\n- Filters by time range (lookbackDays parameter)\n- Extracts workflows with intent, approach, and steps\n- Identifies duration metrics for each step and workflow\n- Extracts entities (technologies, tools, people, organizations)\n- Identifies concepts and topics from workflow content\n- Can filter out noise (Slack, communication apps) if requested\n- Supports attached sessions via @mention (bypasses NLQ retrieval)\n\n**Produces:** userEvidence, a1CritiqueResult\n\n**Requires:** None (can be first skill)\n\n---\n\n### Search Web Best Practices (`search_web_best_practices`)\n\n**Description:** This skill searches the web for industry best practices, expert recommendations, and established workflows using the Perplexity API. It finds external knowledge to supplement internal analysis.\n\nThe skill generates targeted search queries from identified inefficiencies, extracts actionable recommendations with source citations, and maps best practices to the user's specific workflow steps.\n\nThis is typically used when the user asks for industry best practices or external knowledge.\n\n**When to Use:**\n- User explicitly asks for industry best practices\n- Looking for tool-specific tips\n- Need external validation for recommendations\n- User mentions unfamiliar tools or techniques\n- User asks \"what do experts recommend?\"\n- Need up-to-date information about tools or workflows\n\n**Capabilities:**\n- Generates targeted search queries from identified inefficiencies\n- Searches via Perplexity API for relevant articles/documentation\n- Extracts actionable recommendations with source citations\n- Maps external best practices to user-specific workflow steps\n- Generates Claude Code prompts for applicable suggestions\n- Filters for relevance and quality\n- Provides URLs for further reading\n\n**Produces:** webOptimizationPlan\n\n**Requires:** None (can be first skill)\n\n---\n\n### Search Company Documentation (`search_company_docs`)\n\n**Description:** This skill searches the user's uploaded company documentation (internal wikis, runbooks, SOPs, engineering guides) for relevant procedures and guidelines using hybrid RAG with pgvector.\n\nThe skill retrieves relevant sections from company docs with page/section citations, extracts guidance applicable to the user's workflow, and maps internal procedures to current workflow steps.\n\nThis skill requires company docs to be enabled and indexed for the user's organization.\n\n**When to Use:**\n- User's company has indexed documentation\n- Looking for internal procedures or guidelines\n- Task involves company-specific tools or processes\n- Need authoritative internal references\n- User mentions company policies or standards\n- Looking for team-specific best practices\n- User asks about internal tools or workflows\n\n**Capabilities:**\n- Searches company docs using semantic similarity (pgvector)\n- Retrieves relevant sections with page/section citations\n- Extracts guidance applicable to user's workflow\n- Maps internal procedures to current workflow steps\n- Generates Claude Code prompts aligned with company practices\n- Cites specific documents, titles, and page numbers\n\n**Produces:** companyOptimizationPlan\n\n**Requires:** userEvidence\n\n---\n\n### Search Conversation Memory (`search_conversation_memory`)\n\n**Description:** This skill searches previous conversations with the user to retrieve relevant context for follow-up questions. It uses Mem0 for memory storage and retrieval.\n\nThe skill is essential for handling conversational queries where the user references past interactions, such as \"Do you remember when...\", \"Earlier you mentioned...\", or follow-up questions without full context.\n\nThis skill retrieves relevant Q&A pairs, topics, and session references from past conversations.\n\n**When to Use:**\n- User references past conversations (\"remember when...\", \"earlier you mentioned...\")\n- User asks follow-up questions without full context\n- Need to understand ongoing conversation threads\n- User refers to previous recommendations or analysis\n- Query contains temporal references to past interactions (\"last time\", \"before\")\n- User asks \"what did we discuss about...\"\n- User asks \"what did you suggest for...\"\n\n**Capabilities:**\n- Searches Mem0 memory store by semantic similarity\n- Retrieves relevant conversation Q&A pairs\n- Extracts topics and session IDs from memories\n- Formats context for LLM consumption\n- Scores relevance of each retrieved memory\n- Filters by user ID for personalization\n- Can filter by node ID for scoped conversations\n\n**Produces:** conversationMemory\n\n**Requires:** None (can be first skill)\n"
            },
            {
              "message": "expected '\\n### Retrieve User Workflows (`retri' to contain 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected '\\n### Retrieve User Workflows (`retri' to contain 'analyze_workflow_efficiency'\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:207:23\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "analyze_workflow_efficiency",
              "actual": "\n### Retrieve User Workflows (`retrieve_user_workflows`)\n\n**Description:** This skill retrieves the user's captured workflow data from their recorded work sessions. It uses a hybrid RAG (Retrieval-Augmented Generation) approach combining semantic vector search with graph-based retrieval from ArangoDB.\n\nThe skill searches across all user sessions using natural language, extracts workflows, steps, tools used, and duration metrics. It also identifies entities (technologies, tools, people) mentioned in the workflows and can retrieve anonymized peer patterns for comparison.\n\nThis is typically the FIRST skill to invoke when you need to understand what the user has been working on before performing any analysis or providing recommendations.\n\n**When to Use:**\n- User asks about their past work (e.g., \"What did I work on yesterday?\")\n- Need to understand user workflow patterns before analysis\n- Looking for specific sessions or activities\n- User references a task, project, or timeframe\n- Starting any analysis that requires user context\n- User asks about their tools, apps, or technologies used\n- Need to gather evidence for efficiency analysis\n\n**Capabilities:**\n- Searches across all user sessions using natural language queries\n- Filters by time range (lookbackDays parameter)\n- Extracts workflows with intent, approach, and steps\n- Identifies duration metrics for each step and workflow\n- Extracts entities (technologies, tools, people, organizations)\n- Identifies concepts and topics from workflow content\n- Can filter out noise (Slack, communication apps) if requested\n- Supports attached sessions via @mention (bypasses NLQ retrieval)\n\n**Produces:** userEvidence, a1CritiqueResult\n\n**Requires:** None (can be first skill)\n\n---\n\n### Search Web Best Practices (`search_web_best_practices`)\n\n**Description:** This skill searches the web for industry best practices, expert recommendations, and established workflows using the Perplexity API. It finds external knowledge to supplement internal analysis.\n\nThe skill generates targeted search queries from identified inefficiencies, extracts actionable recommendations with source citations, and maps best practices to the user's specific workflow steps.\n\nThis is typically used when the user asks for industry best practices or external knowledge.\n\n**When to Use:**\n- User explicitly asks for industry best practices\n- Looking for tool-specific tips\n- Need external validation for recommendations\n- User mentions unfamiliar tools or techniques\n- User asks \"what do experts recommend?\"\n- Need up-to-date information about tools or workflows\n\n**Capabilities:**\n- Generates targeted search queries from identified inefficiencies\n- Searches via Perplexity API for relevant articles/documentation\n- Extracts actionable recommendations with source citations\n- Maps external best practices to user-specific workflow steps\n- Generates Claude Code prompts for applicable suggestions\n- Filters for relevance and quality\n- Provides URLs for further reading\n\n**Produces:** webOptimizationPlan\n\n**Requires:** None (can be first skill)\n\n---\n\n### Search Company Documentation (`search_company_docs`)\n\n**Description:** This skill searches the user's uploaded company documentation (internal wikis, runbooks, SOPs, engineering guides) for relevant procedures and guidelines using hybrid RAG with pgvector.\n\nThe skill retrieves relevant sections from company docs with page/section citations, extracts guidance applicable to the user's workflow, and maps internal procedures to current workflow steps.\n\nThis skill requires company docs to be enabled and indexed for the user's organization.\n\n**When to Use:**\n- User's company has indexed documentation\n- Looking for internal procedures or guidelines\n- Task involves company-specific tools or processes\n- Need authoritative internal references\n- User mentions company policies or standards\n- Looking for team-specific best practices\n- User asks about internal tools or workflows\n\n**Capabilities:**\n- Searches company docs using semantic similarity (pgvector)\n- Retrieves relevant sections with page/section citations\n- Extracts guidance applicable to user's workflow\n- Maps internal procedures to current workflow steps\n- Generates Claude Code prompts aligned with company practices\n- Cites specific documents, titles, and page numbers\n\n**Produces:** companyOptimizationPlan\n\n**Requires:** userEvidence\n\n---\n\n### Search Conversation Memory (`search_conversation_memory`)\n\n**Description:** This skill searches previous conversations with the user to retrieve relevant context for follow-up questions. It uses Mem0 for memory storage and retrieval.\n\nThe skill is essential for handling conversational queries where the user references past interactions, such as \"Do you remember when...\", \"Earlier you mentioned...\", or follow-up questions without full context.\n\nThis skill retrieves relevant Q&A pairs, topics, and session references from past conversations.\n\n**When to Use:**\n- User references past conversations (\"remember when...\", \"earlier you mentioned...\")\n- User asks follow-up questions without full context\n- Need to understand ongoing conversation threads\n- User refers to previous recommendations or analysis\n- Query contains temporal references to past interactions (\"last time\", \"before\")\n- User asks \"what did we discuss about...\"\n- User asks \"what did you suggest for...\"\n\n**Capabilities:**\n- Searches Mem0 memory store by semantic similarity\n- Retrieves relevant conversation Q&A pairs\n- Extracts topics and session IDs from memories\n- Formats context for LLM consumption\n- Scores relevance of each retrieved memory\n- Filters by user ID for personalization\n- Can filter by node ID for scoped conversations\n\n**Produces:** conversationMemory\n\n**Requires:** None (can be first skill)\n"
            }
          ]
        },
        {
          "name": "should recommend retrieval for EXPLORATION intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend retrieval for EXPLORATION intent",
          "state": "passed"
        },
        {
          "name": "should recommend analysis for OPTIMIZATION intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend analysis for OPTIMIZATION intent",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:229:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:229:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            }
          ]
        },
        {
          "name": "should recommend peer comparison for COMPARISON intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend peer comparison for COMPARISON intent",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:236:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:236:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n]"
            }
          ]
        },
        {
          "name": "should recommend web search for LEARNING intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend web search for LEARNING intent",
          "state": "passed"
        },
        {
          "name": "should recommend features for TOOL_MASTERY intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend features for TOOL_MASTERY intent",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:246:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:246:22\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            }
          ]
        },
        {
          "name": "should recommend memory search for conversational queries",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should recommend memory search for conversational queries",
          "state": "passed"
        },
        {
          "name": "should prioritize web search for TOOL_INTEGRATION intent",
          "fullName": "Skill Selection > getRecommendedSkills by intent > should prioritize web search for TOOL_INTEGRATION intent",
          "state": "passed"
        },
        {
          "name": "should allow retrieval skill with no prerequisites",
          "fullName": "Prerequisite Checking > should allow retrieval skill with no prerequisites",
          "state": "passed"
        },
        {
          "name": "should require userEvidence for judge skill",
          "fullName": "Prerequisite Checking > should require userEvidence for judge skill",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'requires')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'requires')\n    at arePrerequisitesMet (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/skills/skill-types.ts:214:27)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:280:12\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'requires')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'requires')\n    at arePrerequisitesMet (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/skills/skill-types.ts:214:27)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:280:12\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should require multiple prerequisites for comparator skill",
          "fullName": "Prerequisite Checking > should require multiple prerequisites for comparator skill",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'requires')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'requires')\n    at arePrerequisitesMet (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/skills/skill-types.ts:214:27)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:292:12\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'requires')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'requires')\n    at arePrerequisitesMet (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/skills/skill-types.ts:214:27)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:292:12\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return only retrieval and memory skills for empty state",
          "fullName": "Available Skills Filtering > should return only retrieval and memory skills for empty state",
          "state": "passed"
        },
        {
          "name": "should return skills with met prerequisites (usedSkills tracking is separate)",
          "fullName": "Available Skills Filtering > should return skills with met prerequisites (usedSkills tracking is separate)",
          "state": "failed",
          "errors": [
            {
              "message": "expected false to be true // Object.is equality",
              "stack": "AssertionError: expected false to be true // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:340:73\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "true",
              "actual": "false"
            },
            {
              "message": "expected false to be true // Object.is equality",
              "stack": "AssertionError: expected false to be true // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:340:73\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "true",
              "actual": "false"
            }
          ]
        },
        {
          "name": "should make more skills available as state fills",
          "fullName": "Available Skills Filtering > should make more skills available as state fills",
          "state": "failed",
          "errors": [
            {
              "message": "expected false to be true // Object.is equality",
              "stack": "AssertionError: expected false to be true // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:355:64\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "true",
              "actual": "false"
            },
            {
              "message": "expected false to be true // Object.is equality",
              "stack": "AssertionError: expected false to be true // Object.is equality\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:355:64\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runFiles (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1787:3)",
              "expected": "true",
              "actual": "false"
            }
          ]
        },
        {
          "name": "should map \"What did I work on yesterday?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"What did I work on yesterday?...\" to correct skills",
          "state": "passed"
        },
        {
          "name": "should map \"How can I be more productive?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"How can I be more productive?...\" to correct skills",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'analyze_workflow_efficiency'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            }
          ]
        },
        {
          "name": "should map \"How do other engineers handle this?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"How do other engineers handle this?...\" to correct skills",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows' ] to include 'compare_with_peers'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n]"
            }
          ]
        },
        {
          "name": "should map \"What are best practices for testing?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"What are best practices for testing?...\" to correct skills",
          "state": "passed"
        },
        {
          "name": "should map \"What VS Code shortcuts should I use?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"What VS Code shortcuts should I use?...\" to correct skills",
          "state": "failed",
          "errors": [
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            },
            {
              "message": "expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'",
              "stack": "AssertionError: expected [ 'retrieve_user_workflows', (2) ] to include 'discover_underused_features'\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1191:15)\n    at Proxy.<anonymous> (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:410:35\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)",
              "expected": "undefined",
              "actual": "Array [\n  \"retrieve_user_workflows\",\n  \"search_web_best_practices\",\n  \"search_company_docs\",\n]"
            }
          ]
        },
        {
          "name": "should map \"Do you remember what we discussed?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"Do you remember what we discussed?...\" to correct skills",
          "state": "passed"
        },
        {
          "name": "should map \"How do I use OpenClaw in my workflow?...\" to correct skills",
          "fullName": "Query Intent to Skill Mapping > should map \"How do I use OpenClaw in my workflow?...\" to correct skills",
          "state": "passed"
        },
        {
          "name": "should handle empty query",
          "fullName": "Edge Cases > should handle empty query",
          "state": "passed"
        },
        {
          "name": "should handle very long query",
          "fullName": "Edge Cases > should handle very long query",
          "state": "passed"
        },
        {
          "name": "should handle query with special characters",
          "fullName": "Edge Cases > should handle query with special characters",
          "state": "passed"
        },
        {
          "name": "should handle mixed case queries",
          "fullName": "Edge Cases > should handle mixed case queries",
          "state": "passed"
        },
        {
          "name": "should handle queries with typos",
          "fullName": "Edge Cases > should handle queries with typos",
          "state": "passed"
        },
        {
          "name": "should handle typical productivity question flow",
          "fullName": "Integration Scenarios > should handle typical productivity question flow",
          "state": "passed"
        },
        {
          "name": "should handle follow-up conversation flow",
          "fullName": "Integration Scenarios > should handle follow-up conversation flow",
          "state": "passed"
        },
        {
          "name": "should handle best practices request flow",
          "fullName": "Integration Scenarios > should handle best practices request flow",
          "state": "passed"
        },
        {
          "name": "should pass all critical validations",
          "fullName": "Validation Summary > should pass all critical validations",
          "state": "passed"
        },
        {
          "name": "should extract single HTTP URL from query",
          "fullName": "URL Handling > URL extraction from queries > should extract single HTTP URL from query",
          "state": "passed"
        },
        {
          "name": "should extract single HTTPS URL from query",
          "fullName": "URL Handling > URL extraction from queries > should extract single HTTPS URL from query",
          "state": "passed"
        },
        {
          "name": "should extract multiple URLs from query",
          "fullName": "URL Handling > URL extraction from queries > should extract multiple URLs from query",
          "state": "passed"
        },
        {
          "name": "should clean trailing punctuation from URLs",
          "fullName": "URL Handling > URL extraction from queries > should clean trailing punctuation from URLs",
          "state": "passed"
        },
        {
          "name": "should handle URL with complex path",
          "fullName": "URL Handling > URL extraction from queries > should handle URL with complex path",
          "state": "passed"
        },
        {
          "name": "should handle URL with query parameters",
          "fullName": "URL Handling > URL extraction from queries > should handle URL with query parameters",
          "state": "passed"
        },
        {
          "name": "should return empty array when no URLs present",
          "fullName": "URL Handling > URL extraction from queries > should return empty array when no URLs present",
          "state": "passed"
        },
        {
          "name": "should initialize urlFetchedContent as null",
          "fullName": "URL Handling > URL extraction from queries > should initialize urlFetchedContent as null",
          "state": "passed"
        },
        {
          "name": "should have URL fields properly initialized in state",
          "fullName": "URL Handling > URL-based reasoning prioritization > should have URL fields properly initialized in state",
          "state": "passed"
        },
        {
          "name": "should mark URLs as fetched after content is set",
          "fullName": "URL Handling > URL-based reasoning prioritization > should mark URLs as fetched after content is set",
          "state": "passed"
        },
        {
          "name": "should replace all placeholders in system prompt",
          "fullName": "Reasoning Prompt Template Validation > Template placeholder substitution > should replace all placeholders in system prompt",
          "state": "passed"
        },
        {
          "name": "should replace {intent} in both occurrences (classification and task sections)",
          "fullName": "Reasoning Prompt Template Validation > Template placeholder substitution > should replace {intent} in both occurrences (classification and task sections)",
          "state": "passed"
        },
        {
          "name": "should handle empty usedSkills and availableSkills",
          "fullName": "Reasoning Prompt Template Validation > Template placeholder substitution > should handle empty usedSkills and availableSkills",
          "state": "passed"
        },
        {
          "name": "should include all state flags correctly",
          "fullName": "Reasoning Prompt Template Validation > Template placeholder substitution > should include all state flags correctly",
          "state": "failed",
          "errors": [
            {
              "message": "expected '=====================================' to contain 'hasDiagnostics: true'",
              "stack": "AssertionError: expected '=====================================' to contain 'hasDiagnostics: true'\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:752:33\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)",
              "expected": "hasDiagnostics: true",
              "actual": "================================================================================\nCURRENT DECISION CONTEXT\n================================================================================\n\n## USER QUERY\n\"State flags test\"\n\n## QUERY CLASSIFICATION (use this to determine termination criteria)\n- Intent: OPTIMIZATION\n- Scope: HOLISTIC\n- Recommended skills (in priority order): [retrieve_user_workflows]\n\n## STATE FLAGS (check these against TERMINATION MATRIX)\n- Iteration: 3\n- Skills already used: [retrieve_user_workflows, analyze_workflow_efficiency]\n- hasUserEvidence: true\n- hasOptimizationPlans: true\n- hasConversationMemory: true\n\n## LAST OBSERVATION (result from previous skill)\nAnalysis complete\n\n## AVAILABLE SKILLS (only these can be invoked - prerequisites are met)\n[compare_with_peers]\n\n================================================================================\nYOUR TASK\n================================================================================\n\n1. Check TERMINATION MATRIX: Does current state satisfy termination for intent=OPTIMIZATION?\n   - If YES: Set shouldTerminate=true, provide terminationReason\n   - If NO: Continue to step 2\n\n2. Select next skill:\n   - Apply RULE 1: Exclude skills in usedSkills\n   - Apply RULE 3: Prefer skills from recommendedSkills list\n   - Apply RULE 2: Only select from availableSkills\n   - Set skillToInvoke and skillInput\n\n3. Output your decision as valid JSON.\n\nIMPORTANT: Your \"thought\" field must explicitly reference which RULE or MATRIX row justifies your decision."
            },
            {
              "message": "expected '=====================================' to contain 'hasDiagnostics: true'",
              "stack": "AssertionError: expected '=====================================' to contain 'hasDiagnostics: true'\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/agentic-loop/__tests__/agentic-loop-validation.test.ts:752:33\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)",
              "expected": "hasDiagnostics: true",
              "actual": "================================================================================\nCURRENT DECISION CONTEXT\n================================================================================\n\n## USER QUERY\n\"State flags test\"\n\n## QUERY CLASSIFICATION (use this to determine termination criteria)\n- Intent: OPTIMIZATION\n- Scope: HOLISTIC\n- Recommended skills (in priority order): [retrieve_user_workflows]\n\n## STATE FLAGS (check these against TERMINATION MATRIX)\n- Iteration: 3\n- Skills already used: [retrieve_user_workflows, analyze_workflow_efficiency]\n- hasUserEvidence: true\n- hasOptimizationPlans: true\n- hasConversationMemory: true\n\n## LAST OBSERVATION (result from previous skill)\nAnalysis complete\n\n## AVAILABLE SKILLS (only these can be invoked - prerequisites are met)\n[compare_with_peers]\n\n================================================================================\nYOUR TASK\n================================================================================\n\n1. Check TERMINATION MATRIX: Does current state satisfy termination for intent=OPTIMIZATION?\n   - If YES: Set shouldTerminate=true, provide terminationReason\n   - If NO: Continue to step 2\n\n2. Select next skill:\n   - Apply RULE 1: Exclude skills in usedSkills\n   - Apply RULE 3: Prefer skills from recommendedSkills list\n   - Apply RULE 2: Only select from availableSkills\n   - Set skillToInvoke and skillInput\n\n3. Output your decision as valid JSON.\n\nIMPORTANT: Your \"thought\" field must explicitly reference which RULE or MATRIX row justifies your decision."
            }
          ]
        },
        {
          "name": "should contain all required sections in system prompt",
          "fullName": "Reasoning Prompt Template Validation > Prompt structure validation > should contain all required sections in system prompt",
          "state": "passed"
        },
        {
          "name": "should contain termination matrix for all intents",
          "fullName": "Reasoning Prompt Template Validation > Prompt structure validation > should contain termination matrix for all intents",
          "state": "passed"
        },
        {
          "name": "should contain all decision rules (RULE 1-6)",
          "fullName": "Reasoning Prompt Template Validation > Prompt structure validation > should contain all decision rules (RULE 1-6)",
          "state": "passed"
        }
      ]
    },
    {
      "moduleId": "/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts",
      "tests": [
        {
          "name": "should create a new job and return jobId with pending status",
          "fullName": "InsightGenerationService > startJob > should create a new job and return jobId with pending status",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:61:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:61:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should create job with custom options",
          "fullName": "InsightGenerationService > startJob > should create job with custom options",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:77:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:77:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should log job creation",
          "fullName": "InsightGenerationService > startJob > should log job creation",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:85:21\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:85:21\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return null for non-existent job",
          "fullName": "InsightGenerationService > getJob > should return null for non-existent job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.getJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:267:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:93:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.getJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:267:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:93:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return job details for existing job",
          "fullName": "InsightGenerationService > getJob > should return job details for existing job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:99:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:99:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return null for non-existent job",
          "fullName": "InsightGenerationService > getJobProgress > should return null for non-existent job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.getJobProgress (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:276:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:112:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.getJobProgress (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:276:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:112:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return progress for existing job",
          "fullName": "InsightGenerationService > getJobProgress > should return progress for existing job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:118:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:118:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return unsubscribe function",
          "fullName": "InsightGenerationService > subscribeToProgress > should return unsubscribe function",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:131:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:131:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should call listener when progress updates",
          "fullName": "InsightGenerationService > subscribeToProgress > should call listener when progress updates",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:140:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:140:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should stop calling listener after unsubscribe",
          "fullName": "InsightGenerationService > subscribeToProgress > should stop calling listener after unsubscribe",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:150:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:150:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return false for non-existent job",
          "fullName": "InsightGenerationService > cancelJob > should return false for non-existent job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.cancelJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:763:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:162:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'findById')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'findById')\n    at InsightGenerationService.cancelJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:763:45)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:162:36\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return true and cancel existing pending job",
          "fullName": "InsightGenerationService > cancelJob > should return true and cancel existing pending job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:168:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:168:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should return false for already completed job",
          "fullName": "InsightGenerationService > cancelJob > should return false for already completed job",
          "state": "failed",
          "errors": [
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:179:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            },
            {
              "message": "Cannot read properties of undefined (reading 'create')",
              "stack": "TypeError: Cannot read properties of undefined (reading 'create')\n    at InsightGenerationService.startJob (/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/insight-generation.service.ts:174:48)\n    at /Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/insight-generation.service.test.ts:179:39\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n    at file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n    at runTest (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n    at runSuite (file:///Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)"
            }
          ]
        },
        {
          "name": "should generate insights synchronously",
          "fullName": "InsightGenerationService > generateQuickInsights > should generate insights synchronously",
          "state": "passed"
        },
        {
          "name": "should use provided options",
          "fullName": "InsightGenerationService > generateQuickInsights > should use provided options",
          "state": "passed"
        },
        {
          "name": "should handle errors gracefully",
          "fullName": "InsightGenerationService > generateQuickInsights > should handle errors gracefully",
          "state": "passed"
        }
      ]
    },
    {
      "moduleId": "/Users/mrunmayeerane/Desktop/Light-House/lighthouse-journey-canvas/packages/server/src/services/insight-generation/__tests__/context-stitching.service.test.ts",
      "tests": [
        {
          "name": "should group sessions with shared deliverables (advisory board)",
          "fullName": "Context Stitching Service > Tier 1: Outcome-Based Stitching > should group sessions with shared deliverables (advisory board)",
          "state": "passed"
        },
        {
          "name": "should NOT group sessions with only tool overlap",
          "fullName": "Context Stitching Service > Tier 1: Outcome-Based Stitching > should NOT group sessions with only tool overlap",
          "state": "passed"
        },
        {
          "name": "should NOT group sessions with only temporal proximity",
          "fullName": "Context Stitching Service > Tier 1: Outcome-Based Stitching > should NOT group sessions with only temporal proximity",
          "state": "passed"
        },
        {
          "name": "should correctly identify ungrouped sessions",
          "fullName": "Context Stitching Service > Tier 1: Outcome-Based Stitching > should correctly identify ungrouped sessions",
          "state": "passed"
        },
        {
          "name": "should identify tool usage patterns",
          "fullName": "Context Stitching Service > Tier 2: Tool-Mastery Stitching > should identify tool usage patterns",
          "state": "passed"
        },
        {
          "name": "should detect presentation building pattern",
          "fullName": "Context Stitching Service > Tier 2: Tool-Mastery Stitching > should detect presentation building pattern",
          "state": "passed"
        },
        {
          "name": "should detect template reuse pattern",
          "fullName": "Context Stitching Service > Tier 2: Tool-Mastery Stitching > should detect template reuse pattern",
          "state": "passed"
        },
        {
          "name": "should require F1/F2 evidence for high confidence grouping",
          "fullName": "Context Stitching Service > Fact Disambiguation Validation > should require F1/F2 evidence for high confidence grouping",
          "state": "passed"
        },
        {
          "name": "should reject F4/F5 level grouping",
          "fullName": "Context Stitching Service > Fact Disambiguation Validation > should reject F4/F5 level grouping",
          "state": "passed"
        },
        {
          "name": "should detect workstream focus from query",
          "fullName": "Context Stitching Service > Workstream Focus Detection > should detect workstream focus from query",
          "state": "passed"
        },
        {
          "name": "should not invent project names",
          "fullName": "Context Stitching Service > Anti-Hallucination Rules > should not invent project names",
          "state": "passed"
        },
        {
          "name": "should not fabricate frequency counts",
          "fullName": "Context Stitching Service > Anti-Hallucination Rules > should not fabricate frequency counts",
          "state": "passed"
        },
        {
          "name": "should handle sessions with both workstream AND tool patterns",
          "fullName": "Integration Tests > Mixed Session Analysis > should handle sessions with both workstream AND tool patterns",
          "state": "passed"
        },
        {
          "name": "should preserve all sessions (no data loss)",
          "fullName": "Integration Tests > Mixed Session Analysis > should preserve all sessions (no data loss)",
          "state": "passed"
        }
      ]
    }
  ],
  "unhandledErrors": [],
  "reason": "failed"
}
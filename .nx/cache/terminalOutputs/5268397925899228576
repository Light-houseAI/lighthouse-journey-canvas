
> @journey/server@1.0.0 test /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server[39m

 [32mâœ“[39m src/services/__tests__/jwt.service.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1197[2mms[22m[39m
   [33m[2mâœ“[22m[39m JWTService[2m > [22mintegration scenarios[2m > [22mshould support full auth flow [33m 1016[2mms[22m[39m
[90mstdout[2m | tests/api/experience-matches.test.ts[2m > [22m[2mExperience Matches API Contract - GET /api/v2/experience/:nodeId/matches
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/experience-matches.test.ts[2m > [22m[2mExperience Matches API Contract - GET /api/v2/experience/:nodeId/matches
[22m[39mâŒ Failed to create test database test_test_1759494039470_93h2a8: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/experience-matches.test.ts:44:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/experience-matches.test.ts[2m > [22m[2mExperience Matches API Contract - GET /api/v2/experience/:nodeId/matches
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/experience-matches.test.ts:44:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/experience-matches.test.ts[2m > [22m[2mExperience Matches API Contract - GET /api/v2/experience/:nodeId/matches
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/experience-matches.test.ts:207:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/experience-matches.test.ts [2m([22m[2m30 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[32m 52[2mms[22m[39m
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mAuthentication Requirements[2m > [22mshould require authentication
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mAuthentication Requirements[2m > [22mshould reject invalid session tokens
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mNode Access Control[2m > [22mshould return 404 for non-existent nodes
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mNode Access Control[2m > [22mshould return 403 or 404 for nodes user cannot access
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mNode Access Control[2m > [22mshould return 404 for non-experience node types
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mCurrent Experience Detection[2m > [22mshould return matches for current job experiences
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mCurrent Experience Detection[2m > [22mshould return empty matches for past experiences
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mSearch Query Generation[2m > [22mshould prioritize description over title in search query
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mSearch Query Generation[2m > [22mshould fallback to title when description is missing
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mCache Management[2m > [22mshould support force refresh parameter
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mCache Management[2m > [22mshould return fresh data on subsequent requests
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mError Handling[2m > [22mshould handle GraphRAG service errors gracefully
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mError Handling[2m > [22mshould validate UUID format for nodeId parameter
   [2m[90mâ†“[39m[22m Experience Matches API Contract - GET /api/v2/experience/:nodeId/matches[2m > [22mResponse Schema Validation[2m > [22mshould return properly structured response for successful requests
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould identify job with null end date as current[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould identify education with undefined end date as current[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould identify job with future end date as current[32m 1[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould identify job with past end date as not current[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould identify education with past end date as not current[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould reject non-experience node types[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould handle edge case: current month end date[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22misCurrentExperience utility function[2m > [22mshould handle malformed date strings gracefully[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould build search query from node description first[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould fallback to role when description is missing for jobs[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould fallback to degree when description is missing for education[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould return empty string for non-experience nodes[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould handle missing meta gracefully[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould validate search parameters structure[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould reject invalid search parameters[32m 0[2mms[22m[39m
   [32mâœ“[39m Current Experience Detection Logic[2m > [22mGraphRAG Service Integration[2m > [22mshould transform GraphRAG results to match summary format[32m 0[2mms[22m[39m
[90mstdout[2m | tests/api/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mâŒ Failed to create test database test_test_1759494039737_1lccaz: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/auth.test.ts:69:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/auth.test.ts:69:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/auth.test.ts:79:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1436:51)
    at callSuiteHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1442:25)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1738:10)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/auth.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[32m 5[2mms[22m[39m
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signup[2m > [22mshould create a new user with valid data
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signup[2m > [22mshould reject duplicate email registration
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signup[2m > [22mshould reject invalid email format
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signup[2m > [22mshould reject missing required fields
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signin[2m > [22mshould authenticate seeded user with valid credentials
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signin[2m > [22mshould reject invalid credentials
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/signin[2m > [22mshould reject non-existent user
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPATCH /auth/profile[2m > [22mshould update user profile with seeded user authentication
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPATCH /auth/profile[2m > [22mshould reject update without authentication
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/refresh[2m > [22mshould refresh tokens with valid refresh token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/refresh[2m > [22mshould reject invalid refresh token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/logout[2m > [22mshould logout user and revoke tokens
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPOST /auth/logout[2m > [22mshould handle logout even with invalid token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould have valid pre-generated access token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould have valid pre-generated refresh token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould be able to verify access token
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould generate multiple unique test tokens
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould handle invalid token verification
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPre-generated Test Tokens[2m > [22mshould use JWT helper for token validation tests only
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mPerformance[2m > [22mshould respond to signin within 1000ms
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mSecurity[2m > [22mshould not expose sensitive information in error responses
   [2m[90mâ†“[39m[22m Authentication API[2m > [22mSecurity[2m > [22mshould rate limit signup attempts
 [31mâ¯[39m src/controllers/organization.controller.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 158[2mms[22m[39m
   [32mâœ“[39m OrganizationController[2m > [22mgetUserOrganizations[2m > [22mshould fail when user is not authenticated[32m 3[2mms[22m[39m
   [32mâœ“[39m OrganizationController[2m > [22mgetUserOrganizations[2m > [22mshould successfully retrieve user organizations[32m 24[2mms[22m[39m
   [32mâœ“[39m OrganizationController[2m > [22mgetUserOrganizations[2m > [22mshould handle service errors[32m 87[2mms[22m[39m
[31m   [31mÃ—[31m OrganizationController[2m > [22msearchOrganizations[2m > [22mshould successfully search organizations with valid query[39m[32m 27[2mms[22m[39m[33m (retry x1)[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'test company', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'test company', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
   [32mâœ“[39m OrganizationController[2m > [22msearchOrganizations[2m > [22mshould handle validation errors for invalid query parameters[32m 4[2mms[22m[39m
   [32mâœ“[39m OrganizationController[2m > [22msearchOrganizations[2m > [22mshould handle authentication errors[32m 5[2mms[22m[39m
[31m   [31mÃ—[31m OrganizationController[2m > [22msearchOrganizations[2m > [22mshould handle service errors[39m[32m 4[2mms[22m[39m[33m (retry x1)[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'test', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'test', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
   [32mâœ“[39m OrganizationController[2m > [22mhandleError[2m > [22mshould handle generic errors with default message[32m 3[2mms[22m[39m
[90mstdout[2m | tests/api/search-permissions.test.ts[2m > [22m[2mSearch API Permission Filtering
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/search-permissions.test.ts[2m > [22m[2mSearch API Permission Filtering
[22m[39mâŒ Failed to create test database test_test_1759494040247_ram3pv: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/search-permissions.test.ts:43:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/search-permissions.test.ts[2m > [22m[2mSearch API Permission Filtering
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/search-permissions.test.ts:43:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/search-permissions.test.ts[2m > [22m[2mSearch API Permission Filtering
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/search-permissions.test.ts:140:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1436:51)
    at callSuiteHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1442:25)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1738:10)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/search-permissions.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[32m 12[2mms[22m[39m
   [2m[90mâ†“[39m[22m Search API Permission Filtering[2m > [22mPOST /api/v2/graphrag/search[2m > [22mshould only return nodes the requesting user has permission to view
   [2m[90mâ†“[39m[22m Search API Permission Filtering[2m > [22mPOST /api/v2/graphrag/search[2m > [22mshould allow users to see all their own nodes
   [2m[90mâ†“[39m[22m Search API Permission Filtering[2m > [22mPOST /api/v2/graphrag/search[2m > [22mGET /api/v2/experience/:nodeId/matches[2m > [22mshould enforce permissions when fetching experience matches
   [2m[90mâ†“[39m[22m Search API Permission Filtering[2m > [22mPOST /api/v2/graphrag/search[2m > [22mGET /api/v2/experience/:nodeId/matches[2m > [22mshould filter matched nodes based on permissions
   [2m[90mâ†“[39m[22m Search API Permission Filtering[2m > [22mPOST /api/v2/graphrag/search[2m > [22mGET /api/v2/users/search[2m > [22mshould return users but respect node visibility in profiles
[90mstdout[2m | tests/api/health.test.ts[2m > [22m[2mHealth Check Endpoints
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/health.test.ts[2m > [22m[2mHealth Check Endpoints
[22m[39mâŒ Failed to create test database test_test_1759494040868_w4713i: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/health.test.ts:13:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/health.test.ts[2m > [22m[2mHealth Check Endpoints
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/health.test.ts:13:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/health.test.ts[2m > [22m[2mHealth Check Endpoints
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/health.test.ts:18:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1436:51)
    at callSuiteHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1442:25)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1738:10)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/health.test.ts [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 32[2mms[22m[39m
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /health[2m > [22mshould return health status
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /health[2m > [22mshould respond within 100ms
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /health[2m > [22mshould include database health check
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /live[2m > [22mshould return liveness status
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /live[2m > [22mshould respond very quickly (under 50ms)
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /ready[2m > [22mshould return readiness status
   [2m[90mâ†“[39m[22m Health Check Endpoints[2m > [22mGET /ready[2m > [22mshould respond quickly (under 200ms)
[90mstdout[2m | tests/api/onboarding.test.ts[2m > [22m[2mOnboarding API
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/onboarding.test.ts[2m > [22m[2mOnboarding API
[22m[39mâŒ Failed to create test database test_test_1759494041427_7cfzp: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/onboarding.test.ts:19:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/onboarding.test.ts[2m > [22m[2mOnboarding API
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/onboarding.test.ts:19:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/onboarding.test.ts[2m > [22m[2mOnboarding API
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/onboarding.test.ts:27:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1436:51)
    at callSuiteHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1442:25)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1738:10)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/onboarding.test.ts [2m([22m[2m9 tests[22m[2m | [22m[33m9 skipped[39m[2m)[22m[32m 15[2mms[22m[39m
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/interest[2m > [22mshould save user interest
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/interest[2m > [22mshould reject interest update without authentication
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/interest[2m > [22mshould validate interest field
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/extract-profile[2m > [22mshould handle profile extraction endpoint
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/save-profile[2m > [22mshould handle profile saving endpoint
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/complete[2m > [22mshould complete the onboarding process
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/complete[2m > [22mshould update user onboarding status
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mPOST /onboarding/complete[2m > [22mshould reject completion without authentication
   [2m[90mâ†“[39m[22m Onboarding API[2m > [22mOnboarding Flow Integration[2m > [22mshould complete full onboarding flow
[90mstdout[2m | tests/api/updates.interview.test.ts[2m > [22m[2mUpdates API
[22m[39mðŸ”„ Creating database connection...

[90mstderr[2m | tests/api/updates.interview.test.ts[2m > [22m[2mUpdates API
[22m[39mâŒ Failed to create test database test_test_1759494041701_mvv4p: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/updates.interview.test.ts:27:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/updates.interview.test.ts[2m > [22m[2mUpdates API
[22m[39mâŒ Failed to configure Awilix container: AggregateError: 
    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/pg-pool@3.10.1_pg@8.16.3/node_modules/[4mpg-pool[24m/index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at Function.createTestDatabaseFromTemplate [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/test-database-creator.ts:36:7[90m)[39m
    at Function.createTestConfig [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database-factory.ts:93:5[90m)[39m
    at Module.createDatabaseConnection [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/config/database.connection.ts:15:18[90m)[39m
    at Function.configure [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:79:24[90m)[39m
    at Module.createApp [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/app.ts:30:3[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/updates.interview.test.ts:27:11 {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:5433
    [90m    at createConnectionError (node:net:1652:14)[39m
    [90m    at afterConnectMultiple (node:net:1682:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m
    }
  ]
}

[90mstderr[2m | tests/api/updates.interview.test.ts[2m > [22m[2mUpdates API
[22m[39mCould not dispose database connection: AwilixResolutionError: Could not resolve 'database'.

Resolution path: database
    at Object.resolve (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/awilix@12.0.5/node_modules/[4mawilix[24m/lib/awilix.module.mjs:1531:23)
    at Function.dispose [90m(/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/core/container-setup.ts:229:45[90m)[39m
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39mtests/api/updates.interview.test.ts:56:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1436:51)
    at callSuiteHook (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1442:25)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1738:10)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

 [31mâ¯[39m tests/api/updates.interview.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[32m 8[2mms[22m[39m
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPOST /api/nodes/:nodeId/updates[2m > [22mshould create update with only checkboxes
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPOST /api/nodes/:nodeId/updates[2m > [22mshould return 404 for non-existent update
   [2m[90mâ†“[39m[22m Updates API[2m > [22mDELETE /api/nodes/:nodeId/updates/:updateId[2m > [22mshould soft delete update
   [2m[90mâ†“[39m[22m Updates API[2m > [22mDELETE /api/nodes/:nodeId/updates/:updateId[2m > [22mshould return 404 for non-existent update
   [2m[90mâ†“[39m[22m Updates API[2m > [22mCreate update with interview activity[2m > [22mshould create update with interview activity flags
   [2m[90mâ†“[39m[22m Updates API[2m > [22mCreate update with interview activity[2m > [22mshould handle activity flag updates
   [2m[90mâ†“[39m[22m Updates API[2m > [22mCreate update with interview activity[2m > [22mshould render text for vector database search
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPermission denial integration[2m > [22mshould deny access to updates for unauthorized node
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPermission denial integration[2m > [22mshould deny reading updates for unauthorized node
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPermission denial integration[2m > [22mshould deny updating specific update for unauthorized node
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPermission denial integration[2m > [22mshould deny deleting specific update for unauthorized node
   [2m[90mâ†“[39m[22m Updates API[2m > [22mPermission denial integration[2m > [22mshould allow update owner to modify their own updates
 [32mâœ“[39m src/utils/__tests__/experience-utils.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [31mâ¯[39m tests/api/organizations.test.ts [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 3[2mms[22m[39m
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould search organizations by name
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould return fuzzy matches for partial company names
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould handle empty search query
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould support pagination parameters
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould return 400 for invalid pagination parameters
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould require authentication
   [2m[90mâ†“[39m[22m Organizations API[2m > [22mGET /api/organizations/search[2m > [22mshould create new organization when not found
 [32mâœ“[39m tests/api/node-details.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 74[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/user.service.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 384[2mms[22m[39m
   [33m[2mâœ“[22m[39m User Service Tests[2m > [22mUser Profile Persistence (LIG-185)[2m > [22mcreateUser[2m > [22mshould create user with profile data [33m 375[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/refresh-token.service.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/pgvector-graphrag.service.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/hierarchy-service-advanced.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 55[2mms[22m[39m
[90mstderr[2m | src/controllers/auth.controller.test.ts[2m > [22m[2mAuthController[2m > [22m[2mlogout[2m > [22m[2mshould handle logout even with invalid token
[22m[39mError revoking refresh token during logout: Error: Invalid token
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/controllers/auth.controller.test.ts:413:21
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)

 [32mâœ“[39m src/controllers/auth.controller.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 35[2mms[22m[39m
[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould successfully find and convert LinkedIn profile data
[22m[39mSearching People Data Labs for LinkedIn user: john-doe

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould successfully find and convert LinkedIn profile data
[22m[39mFound PDL data for John Doe
PDL conversion complete: 1 experiences, 1 education, 4 skills

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould return null when API key is missing
[22m[39mNo People Data Labs API key found

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould handle 404 not found error gracefully
[22m[39mSearching People Data Labs for LinkedIn user: nonexistent-user

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould handle 404 not found error gracefully
[22m[39mPerson not found in People Data Labs

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould handle 400 bad request error gracefully
[22m[39mSearching People Data Labs for LinkedIn user: invalid-username

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByName[2m > [22m[2mshould successfully find person by name with location
[22m[39mSearching People Data Labs by name: Jane Smith

[90mstderr[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByLinkedIn[2m > [22m[2mshould handle 400 bad request error gracefully
[22m[39mPDL API 400 error - checking request format: {
  profile: [32m'linkedin.com/in/invalid-username'[39m,
  status: [33m400[39m,
  data: { error: [32m'Invalid profile format'[39m },
  requestUrl: [90mundefined[39m,
  requestParams: [90mundefined[39m
}

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByName[2m > [22m[2mshould successfully find person by name with location
[22m[39mFound PDL data by name for Jane Smith
PDL conversion complete: 1 experiences, 0 education, 0 skills

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByName[2m > [22m[2mshould use US default when no location provided
[22m[39mSearching People Data Labs by name: Bob Johnson

[90mstdout[2m | src/services/__tests__/people-data-labs.service.test.ts[2m > [22m[2mPeopleDataLabsService[2m > [22m[2msearchPersonByName[2m > [22m[2mshould use US default when no location provided
[22m[39mFound PDL data by name for Bob Johnson
PDL conversion complete: 0 experiences, 0 education, 0 skills

 [32mâœ“[39m src/services/__tests__/people-data-labs.service.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 56[2mms[22m[39m
 [32mâœ“[39m tests/api/profile.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 60[2mms[22m[39m
 [32mâœ“[39m src/controllers/hierarchy-controller.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 107[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/experience-matches.service.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/controllers/user.controller.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 125[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/hierarchy-repository-advanced.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 50[2mms[22m[39m
 [32mâœ“[39m src/utils/__tests__/response-builder.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/pgvector-graphrag.repository.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 125[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/organization.service.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 38[2mms[22m[39m
 [32mâœ“[39m tests/api/user.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m src/controllers/node-permission.controller.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 89[2mms[22m[39m
 [32mâœ“[39m src/controllers/health.controller.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m src/controllers/pgvector-graphrag.controller.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by first name with case-insensitive matching
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m'john'[39m,
  searchTerm: [32m'john'[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by first name with case-insensitive matching
[22m[39mUserRepository.searchUsers result: { searchTerm: [32m'john'[39m, resultCount: [33m2[39m, userIds: [ [33m1[39m, [33m2[39m ] }

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by last name with case-insensitive matching
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m'SMITH'[39m,
  searchTerm: [32m'smith'[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by last name with case-insensitive matching
[22m[39mUserRepository.searchUsers result: { searchTerm: [32m'smith'[39m, resultCount: [33m2[39m, userIds: [ [33m1[39m, [33m2[39m ] }

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by full name with case-insensitive matching
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m'john doe'[39m,
  searchTerm: [32m'john doe'[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould search users by full name with case-insensitive matching
[22m[39mUserRepository.searchUsers result: { searchTerm: [32m'john doe'[39m, resultCount: [33m1[39m, userIds: [ [33m1[39m ] }

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould limit results to 20 users
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m'user'[39m,
  searchTerm: [32m'user'[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould limit results to 20 users
[22m[39mUserRepository.searchUsers result: {
  searchTerm: [32m'user'[39m,
  resultCount: [33m20[39m,
  userIds: [
     [33m1[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,  [33m5[39m,  [33m6[39m,  [33m7[39m,
     [33m8[39m,  [33m9[39m, [33m10[39m, [33m11[39m, [33m12[39m, [33m13[39m, [33m14[39m,
    [33m15[39m, [33m16[39m, [33m17[39m, [33m18[39m, [33m19[39m, [33m20[39m
  ]
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould handle database errors gracefully
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m'test'[39m,
  searchTerm: [32m'test'[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstderr[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould handle database errors gracefully
[22m[39mDatabase search error: Error: Database connection failed
    at [90m/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/[39msrc/repositories/__tests__/user-repository.test.ts:155:23
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould handle special characters in search query
[22m[39mUserRepository.searchUsers: {
  originalQuery: [32m"o'neill"[39m,
  searchTerm: [32m"o'neill"[39m,
  queryType: [32m'name search with experience'[39m
}

[90mstdout[2m | src/repositories/__tests__/user-repository.test.ts[2m > [22m[2mUser Repository Tests[2m > [22m[2mSearch Users[2m > [22m[2mshould handle special characters in search query
[22m[39mUserRepository.searchUsers result: { searchTerm: [32m"o'neill"[39m, resultCount: [33m1[39m, userIds: [ [33m1[39m ] }

 [32mâœ“[39m src/repositories/__tests__/user-repository.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/middleware-integration.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m src/controllers/__tests__/user-onboarding-controller.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/openai-embedding.service.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/batch-authorization.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/node-permission.service.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/enhanced-permissions.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | src/services/__tests__/multi-source-extractor.test.ts[2m > [22m[2mMultiSourceExtractor[2m > [22m[2mextractComprehensiveProfile[2m > [22m[2mshould extract profile data from People Data Labs when available
[22m[39mStarting comprehensive profile extraction for: johndoe
Searching People Data Labs for enhanced professional data...

[90mstdout[2m | src/services/__tests__/multi-source-extractor.test.ts[2m > [22m[2mMultiSourceExtractor[2m > [22m[2mextractComprehensiveProfile[2m > [22m[2mshould extract profile data from People Data Labs when available
[22m[39mPeople Data Labs found data via LinkedIn username.

 [32mâœ“[39m src/services/__tests__/multi-source-extractor.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/controllers/base-controller.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/transaction-manager.service.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/node-permission.repository.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/organization.repository.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/controllers/__tests__/experience-matches.controller.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/repositories/__tests__/insight-repository.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Suites 7 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m tests/api/auth.test.ts[2m > [22mAuthentication API
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/auth.test.ts:69:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/auth.test.ts'[39m,
      line: [33m69[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/auth.test.ts:[2m69:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/experience-matches.test.ts[2m > [22mExperience Matches API Contract - GET /api/v2/experience/:nodeId/matches
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/experience-matches.test.ts:44:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/experience-matches.test.ts'[39m,
      line: [33m44[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/experience-matches.test.ts:[2m44:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/health.test.ts[2m > [22mHealth Check Endpoints
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/health.test.ts:13:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/health.test.ts'[39m,
      line: [33m13[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/health.test.ts:[2m13:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/onboarding.test.ts[2m > [22mOnboarding API
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/onboarding.test.ts:19:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/onboarding.test.ts'[39m,
      line: [33m19[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/onboarding.test.ts:[2m19:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/organizations.test.ts[2m > [22mOrganizations API
[31m[1mTypeError[22m: Container.getInstance is not a function[39m
[36m [2mâ¯[22m tests/api/organizations.test.ts:[2m55:33[22m[39m
    [90m 53| [39m[34mdescribe[39m([32m'Organizations API'[39m[33m,[39m () [33m=>[39m {
    [90m 54| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 55| [39m    [35mconst[39m container [33m=[39m [33mContainer[39m[33m.[39m[34mgetInstance[39m()[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m 56| [39m    app [33m=[39m [34mcreateApp[39m(container)[33m;[39m
    [90m 57| [39m    authSession [33m=[39m [35mawait[39m [34mauthenticateSeededUser[39m(app)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/organizations.test.ts[2m > [22mOrganizations API
[31m[1mTypeError[22m: Container.getInstance is not a function[39m
[36m [2mâ¯[22m tests/api/organizations.test.ts:[2m61:33[22m[39m
    [90m 59| [39m
    [90m 60| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 61| [39m    [35mconst[39m container [33m=[39m [33mContainer[39m[33m.[39m[34mgetInstance[39m()[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m 62| [39m    [35mawait[39m container[33m.[39m[34mdispose[39m()[33m;[39m
    [90m 63| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/search-permissions.test.ts[2m > [22mSearch API Permission Filtering
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/search-permissions.test.ts:43:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/search-permissions.test.ts'[39m,
      line: [33m43[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/search-permissions.test.ts:[2m43:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/api/updates.interview.test.ts[2m > [22mUpdates API
{
  stack: [32m'AggregateError: \n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at Function.createTestDatabaseFromTemplate (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts:36:7)\n'[39m +
    [32m'    at Function.createTestConfig (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts:93:5)\n'[39m +
    [32m'    at Module.createDatabaseConnection (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts:15:18)\n'[39m +
    [32m'    at Function.configure (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts:79:24)\n'[39m +
    [32m'    at Module.createApp (/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts:30:3)\n'[39m +
    [32m'    at /Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/updates.interview.test.ts:27:11'[39m,
  errors: [
    {
      stack: [32m'Error: connect ECONNREFUSED ::1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED ::1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    },
    {
      stack: [32m'Error: connect ECONNREFUSED 127.0.0.1:5433\n'[39m +
        [32m'    at createConnectionError (node:net:1652:14)\n'[39m +
        [32m'    at afterConnectMultiple (node:net:1682:16)'[39m,
      message: [32m'connect ECONNREFUSED 127.0.0.1:5433'[39m,
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m5433[39m,
      constructor: [32m'Function<Error>'[39m,
      name: [32m'Error'[39m,
      toString: [32m'Function<toString>'[39m
    }
  ],
  code: [32m'ECONNREFUSED'[39m,
  message: [32m''[39m,
  constructor: [32m'Function<AggregateError>'[39m,
  name: [32m'AggregateError'[39m,
  toString: [32m'Function<toString>'[39m,
  stacks: [
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js'[39m,
      line: [33m45[39m,
      column: [33m11[39m
    },
    {
      method: [32m'Function.createTestDatabaseFromTemplate'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/test-database-creator.ts'[39m,
      line: [33m36[39m,
      column: [33m7[39m
    },
    {
      method: [32m'Function.createTestConfig'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database-factory.ts'[39m,
      line: [33m93[39m,
      column: [33m5[39m
    },
    {
      method: [32m'Module.createDatabaseConnection'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/config/database.connection.ts'[39m,
      line: [33m15[39m,
      column: [33m18[39m
    },
    {
      method: [32m'Function.configure'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/core/container-setup.ts'[39m,
      line: [33m79[39m,
      column: [33m24[39m
    },
    {
      method: [32m'Module.createApp'[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/src/app.ts'[39m,
      line: [33m30[39m,
      column: [33m3[39m
    },
    {
      method: [32m''[39m,
      file: [32m'/Users/spidey/code/Lighthouse/journey/feature_worktrees/LIG-192/packages/server/tests/api/updates.interview.test.ts'[39m,
      line: [33m27[39m,
      column: [33m11[39m
    }
  ]
}
[90m [2mâ¯[22m ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:[2m45:11[22m[39m
[36m [2mâ¯[22m Function.createTestDatabaseFromTemplate src/config/test-database-creator.ts:[2m36:7[22m[39m
    [90m 34| [39m    [35mtry[39m {
    [90m 35| [39m      [90m// Create empty database first[39m
    [90m 36| [39m      [35mawait[39m adminPool[33m.[39m[34mquery[39m([32m`CREATE DATABASE "[39m[36m${[39mtestDatabaseName[36m}[39m[32m"`[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 37| [39m
    [90m 38| [39m      [90m// Connect to new database and set up schema + fixture data[39m
[90m [2mâ¯[22m Function.createTestConfig src/config/database-factory.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m Module.createDatabaseConnection src/config/database.connection.ts:[2m15:18[22m[39m
[90m [2mâ¯[22m Function.configure src/core/container-setup.ts:[2m79:24[22m[39m
[90m [2mâ¯[22m Module.createApp src/app.ts:[2m30:3[22m[39m
[90m [2mâ¯[22m tests/api/updates.interview.test.ts:[2m27:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/12]âŽ¯[22m[39m


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 2 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m src/controllers/organization.controller.test.ts[2m > [22mOrganizationController[2m > [22msearchOrganizations[2m > [22mshould successfully search organizations with valid query
[41m[1m FAIL [22m[49m src/controllers/organization.controller.test.ts[2m > [22mOrganizationController[2m > [22msearchOrganizations[2m > [22mshould successfully search organizations with valid query
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'test company', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m src/controllers/organization.controller.test.ts:[2m168:9[22m[39m
    [90m166| [39m      [34mexpect[39m(
    [90m167| [39m        mockOrganizationRepository[33m.[39msearchOrganizations
    [90m168| [39m      )[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'test company'[39m[33m,[39m [34m10[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m169| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m170| [39m        success[33m:[39m [35mtrue[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/12]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/controllers/organization.controller.test.ts[2m > [22mOrganizationController[2m > [22msearchOrganizations[2m > [22mshould handle service errors
[41m[1m FAIL [22m[49m src/controllers/organization.controller.test.ts[2m > [22mOrganizationController[2m > [22msearchOrganizations[2m > [22mshould handle service errors
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'test', 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m src/controllers/organization.controller.test.ts:[2m235:9[22m[39m
    [90m233| [39m      [34mexpect[39m(
    [90m234| [39m        mockOrganizationRepository[33m.[39msearchOrganizations
    [90m235| [39m      )[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'test'[39m[33m,[39m [34m10[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m236| [39m      [34mexpect[39m(mockLogger[33m.[39merror)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m237| [39m        [32m'Error searching organizations'[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/12]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m35 passed[39m[22m[90m (43)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m420 passed[39m[22m[2m | [22m[33m76 skipped[39m[90m (498)[39m
[2m   Start at [22m 17:50:34
[2m   Duration [22m 12.18s[2m (transform 2.24s, setup 334ms, collect 7.54s, tests 2.82s, environment 0ms, prepare 238ms)[22m

[41m[30mâ€‰ELIFECYCLEâ€‰[39m[49m [31mTest failed. See above for more details.[39m

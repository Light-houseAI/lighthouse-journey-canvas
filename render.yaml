services:
  - type: web
    name: lighthouse-app
    runtime: node
    plan: starter  # Change to 'standard' or higher for production
    region: oregon  # Change to your preferred region
    branch: main    # Change to your deployment branch
    buildCommand: pnpm install --frozen-lockfile && pnpm run build
    startCommand: pnpm start

    # Environment variables (set these in Render dashboard)
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: SESSION_SECRET
        generateValue: true  # Render will generate a secure secret

      # JWT lifetimes
      # NOTE: Desktop companion refreshes 15 minutes before expiry, so keep access tokens > 15m.
      - key: JWT_ACCESS_EXPIRY
        value: 1h
      - key: JWT_REFRESH_EXPIRY
        value: 30d

      # Database - You'll need to set these in Render dashboard
      - key: DATABASE_URL
        fromDatabase:
          name: lighthouse-db  # Your PostgreSQL database service name
          property: connectionString

      # API Keys - Set these in Render dashboard (DO NOT commit actual keys)
      # These are required for the application to work properly:
      # - OPENAI_API_KEY: For LLM-powered workflow analysis
      # - JWT_ACCESS_SECRET: For JWT token generation
      # - JWT_REFRESH_SECRET: For refresh token generation
      # - QDRANT_URL: Vector database URL
      # - QDRANT_API_KEY: Vector database API key
      # - REDIS_HOST: Redis host for caching
      # - REDIS_PORT: Redis port
      # - REDIS_PASSWORD: Redis password
      # - GCP_SERVICE_ACCOUNT_KEY: Google Cloud Platform service account key
      # - GCP_BUCKET_NAME: GCP storage bucket name

      # ArangoDB (Graph RAG) - Set these in Render dashboard
      # NOTE: ArangoDB is not available as a managed service on Render.
      # Options:
      #   1. Use ArangoGraph Insights Platform (cloud.arangodb.com)
      #   2. Deploy ArangoDB on AWS/GCP/Azure and connect via URL
      #   3. Disable Graph RAG by setting ENABLE_GRAPH_RAG=false
      # - ARANGO_URL: ArangoDB connection URL
      # - ARANGO_DATABASE: Database name (e.g., lighthouse_graph)
      # - ARANGO_USERNAME: Database username (e.g., root)
      # - ARANGO_PASSWORD: Database password
      # - ENABLE_GRAPH_RAG: Enable/disable Graph RAG features (true/false)
      # - ENABLE_CROSS_SESSION_CONTEXT: Enable cross-session analysis (true/false)
      # - GRAPH_RAG_MAX_DEPTH: Maximum graph traversal depth (default: 3)
      # - GRAPH_RAG_LOOKBACK_DAYS: Days to look back for context (default: 90)

      # Optional: Redis for sessions (recommended for production)
      # - key: REDIS_URL
      #   fromService:
      #     name: lighthouse-redis
      #     type: redis
      #     property: connectionString

    # Health check configuration
    healthCheckPath: /health

    # Build and start commands configured above
    # buildCommand: pnpm install --frozen-lockfile && pnpm run build
    # startCommand: pnpm start

    # Auto-deploy on push to branch
    autoDeploy: true

# Database service (PostgreSQL)
databases:
  - name: lighthouse-db
    databaseName: lighthouse
    plan: starter  # Change to 'standard' or higher for production
    region: oregon  # Should match web service region

    # Optional: Database initialization
    # You may need to run migrations after deployment:
    # pnpm run db:migrate

# Optional: Redis service for session storage (recommended for production)
# services:
#   - type: redis
#     name: lighthouse-redis
#     plan: starter
#     region: oregon
#     maxmemoryPolicy: allkeys-lru
